# nlcTables 数据集介绍与实验指南

## 📊 数据集概述

**nlcTables** 是一个专门用于评估**自然语言表格发现**系统的数据集。与 WebTable 和 OpenData 使用表格作为查询不同，nlcTables 使用**自然语言描述**来查找相关表格。

## 🗂️ 数据集结构

```
nlcTables/
├── nlcTables-J/        # JOIN任务数据集
│   ├── 4,872个表格
│   ├── 91个自然语言查询
│   └── 分级相关性评分 (0-2分)
└── nlcTables-U/        # UNION任务数据集
    ├── 7,567个表格
    ├── 255个自然语言查询
    └── 分级相关性评分 (0-2分)
```

## 🎯 核心特点

### 1. **自然语言查询**
查询示例：
- "找到包含关键词 '0.363' 且主题与体育团队统计相关的可连接表格"
- "我需要找到 Given-name 为 'Emma Frances' 且包含关键词 'Henry' 的可合并表格"
- "查找与 'Markham' 关键词相关且主题为洗礼记录的表格"

### 2. **查询复杂度特征**
- 🔍 **关键词匹配**：直接关键词搜索
- 📚 **主题约束**：领域特定主题要求
- 📊 **列约束**：特定列名或值要求
- 📏 **大小约束**：最小行数/列数要求
- ⏰ **时间约束**：日期/时间范围指定

### 3. **分级相关性评分**
- **0分**：不相关
- **1分**：部分相关
- **2分**：高度相关

## 📈 与现有数据集对比

| 特征 | WebTable | OpenData | nlcTables |
|------|----------|----------|-----------|
| **查询类型** | 基于表格 | 基于表格 | 自然语言 |
| **JOIN查询数** | 1,042 | 500 | 91 |
| **UNION查询数** | 3,222 | 3,095 | 255 |
| **总表格数** | 6,487 | 3,595 | 12,439 |
| **查询复杂度** | 低 | 中 | 高 |
| **真实场景相关性** | 中 | 高 | 非常高 |

## 🔧 如何进行实验

### 步骤 1：数据转换
```bash
# 转换 nlcTables 到系统格式
python convert_nlctables.py \
    --input /root/autodl-tmp/datalakes/nlcTables \
    --output /root/dataLakesMulti/examples/nlctables \
    --task both
```

### 步骤 2：运行实验
```bash
# 完整实验
python three_layer_ablation_optimized.py \
    --dataset examples/nlctables \
    --task both \
    --max-queries 50 \
    --layers L1+L2+L3

# 快速测试（使用子集）
python three_layer_ablation_optimized.py \
    --dataset examples/nlctables/join_subset \
    --task join \
    --max-queries 10
```

### 步骤 3：评估结果
由于使用分级相关性，需要使用 **NDCG** (归一化折损累积增益) 指标：
```python
# NDCG@5 评估
ndcg_score = calculate_ndcg(predictions, ground_truth, relevance_scores, k=5)
```

## 💡 实验挑战与解决方案

### 挑战 1：自然语言理解
- **问题**：自然语言查询比表格查询更模糊
- **解决**：使用 LLM 进行查询理解和特征提取

### 挑战 2：语义鸿沟
- **问题**：从自然语言到结构化表格匹配的转换
- **解决**：增强向量嵌入，结合关键词和语义匹配

### 挑战 3：分级相关性
- **问题**：系统设计为二分类（相关/不相关）
- **解决**：调整评分函数支持多级相关性

## 🚀 实验方案

### 阶段 1：基线评估
1. 不修改系统，直接运行
2. 测量性能下降程度
3. 分析错误模式

### 阶段 2：自然语言增强
1. 实现查询理解模块
2. 添加关键词提取和主题建模
3. 增强 L1 元数据过滤器

### 阶段 3：系统优化
1. 微调 LLM 提示词
2. 调整向量嵌入策略
3. 优化阈值参数

## 📊 预期结果

基于数据集特点，预期：
- **JOIN 任务**：性能可能低于 WebTable/OpenData（查询更复杂）
- **UNION 任务**：性能可能更好（有更多相关表格）
- **整体准确率**：初始可能在 40-60%，优化后可达 70-80%

## 🎯 关键见解

1. **更真实的场景**：自然语言查询更接近实际用户需求
2. **更高的复杂度**：需要语义理解能力
3. **更好的评估**：分级相关性提供更细粒度的评估
4. **跨领域挑战**：表格跨越多个领域，需要广泛理解

## ✅ 推荐策略

1. **从简单开始**：先实现基于关键词的匹配
2. **利用 LLM**：使用 Gemini/GPT 进行查询理解
3. **混合方法**：结合自然语言特征与现有向量搜索
4. **增量开发**：在现有系统基础上逐步构建
5. **仔细评估**：使用适合分级相关性的指标

## 📝 总结

nlcTables 是一个**高质量、高挑战性**的数据集，特别适合：
- 评估系统的**自然语言理解**能力
- 测试**真实场景**下的表格发现性能
- 推动系统向**更智能化**方向发展

虽然查询数量较少，但每个查询都经过精心设计，具有很高的研究价值。